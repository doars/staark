var j=Object.defineProperty;var M=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var S=(t,a,r)=>a in t?j(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,f=(t,a)=>{for(var r in a||(a={}))I.call(a,r)&&S(t,r,a[r]);if(M)for(var r of M(a))U.call(a,r)&&S(t,r,a[r]);return t};var m=(t,a,r)=>new Promise((u,l)=>{var x=e=>{try{b(r.next(e))}catch(n){l(n)}},y=e=>{try{b(r.throw(e))}catch(n){l(n)}},b=e=>e.done?u(e.value):Promise.resolve(e.value).then(x,y);b((r=r.apply(t,a)).next())});var D=t=>{if(typeof t=="object"){let a=Array.isArray(t)?[]:{};for(let r in t)a[r]=D(t[r]);return a}return t};var C=t=>m(null,null,function*(){return t>0?new Promise(a=>setTimeout(a,t)):null});var L=t=>t.split(";")[0].trim().toLowerCase(),z=t=>{let a=t.match(/\.([^./?]+)(?:[?#]|$)/);return a?a[1].toLowerCase():null},v=(t,a,r)=>{let u=a.get("Content-Type");if(u)return L(u);if(r&&r.Accept){let x=r.Accept.split(",");for(let y of x)if(y.trim()!=="*/*")return L(y)}let l=z(t);return l||""};var B={method:"get",retryCodes:[429,503,504],retryDelay:500},W=t=>{t=f(f({},B),D(t));let a=0,r=0,u=0,l=null,x=e=>m(null,null,function*(){let n=Date.now(),i=e-(n-a);a=n+(i>0?i:0),yield C(i)}),y=e=>new Promise(n=>{l&&clearTimeout(l),l=setTimeout(n,e)}),b=e=>m(null,null,function*(){if(e.maxRequests!==void 0&&u>=e.maxRequests)return[new Error("Maximum request limit reached"),null,null];u++;let n={cache:e.cache,credentials:e.credentials,headers:e.headers,method:e.method,mode:e.mode,redirect:e.redirect,body:e.body?JSON.stringify(e.body):void 0},i=(e.domain||"")+(e.path||"");if(e.queryParams&&(i+="?"+new URLSearchParams(e.queryParams).toString()),e.timeout){let s=e.abort||new AbortController;n.signal=s.signal,setTimeout(()=>s.abort(),e.timeout)}let T=()=>m(null,null,function*(){var p;let s=yield((p=e.fetch)!=null?p:fetch)(i,n);if(!s.ok)return[new Error("Invalid response"),s,null];try{let c,w=!1,h=e.type||v(i,s.headers,e.headers);if(e.parsers){for(let o of e.parsers)if(w=o.types.includes(h),w){c=yield o.parser(s,e,h);break}}if(!w)switch(h.toLowerCase()){case"arraybuffer":c=yield s.arrayBuffer();break;case"blob":c=yield s.blob();break;case"formdata":c=yield s.formData();break;case"text/plain":case"text":case"txt":c=yield s.text();break;case"text/html-partial":case"html-partial":c=yield s.text();let o=document.createElement("template");o.innerHTML=c,c=o.content.childNodes;break;case"text/html":case"html":c=yield s.text(),c=new DOMParser().parseFromString(c,"text/html");break;case"application/json":case"text/json":case"json":c=yield s.json();break;case"image/svg+xml":case"svg":c=yield s.text(),c=new DOMParser().parseFromString(c,"image/svg+xml");break;case"application/xml":case"text/xml":case"xml":c=yield s.text(),c=new DOMParser().parseFromString(c,"application/xml");break}return[null,s,c]}catch(c){return[c||new Error("Thrown parsing error is falsy"),s,null]}}),d=()=>m(null,null,function*(){var w;let s=0,p=e.retryAttempts||0,c=e.retryDelay||0;for(;s<p;){let[h,o,E]=yield T();if(!h)return[h,o,E];if(!((w=e.retryCodes)!=null&&w.includes(o.status||200)))return[new Error("Invalid status code"),o,E];if(s++,s>=p)return[new Error("Too many retry attempts"),o,E];let g=c*Math.pow(2,s-1),P=o.headers.get("Retry-After");if(P){let q=parseInt(P,10);if(!isNaN(q))g=Math.max(g,q*1e3);else{let F=new Date(P).getTime();if(!isNaN(F)){let N=Date.now();g=Math.max(g,F-N)}}}yield C(g)}return T()}),[A,k,R]=yield d();return k.ok?[A,k,R]:[new Error(k.statusText),k,R]});return e=>m(null,null,function*(){let n=f(f({},t),D(e));t.headers&&(n.headers=f(f({},t.headers),n.headers)),n.debounce&&(yield y(n.debounce)),n.delay&&(yield C(n.delay)),n.throttle&&(yield x(n.throttle)),n.maxConcurrency&&r>=n.maxConcurrency&&(yield new Promise(T=>{let d=null,A=()=>{r>=n.maxConcurrency?d=requestAnimationFrame(A):(d&&clearInterval(d),T(null))};d=requestAnimationFrame(A)})),r++;let i=yield b(n);return r--,i})};export{W as create};
