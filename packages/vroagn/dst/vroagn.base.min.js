var I=Object.defineProperty;var S=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var M=(t,n,r)=>n in t?I(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,y=(t,n)=>{for(var r in n||(n={}))N.call(n,r)&&M(t,r,n[r]);if(S)for(var r of S(n))j.call(n,r)&&M(t,r,n[r]);return t};var u=(t,n,r)=>new Promise((m,i)=>{var w=e=>{try{b(r.next(e))}catch(s){i(s)}},d=e=>{try{b(r.throw(e))}catch(s){i(s)}},b=e=>e.done?m(e.value):Promise.resolve(e.value).then(w,d);b((r=r.apply(t,n)).next())});var P=t=>{if(typeof t=="object"){let n=Array.isArray(t)?[]:{};for(let r in t)n[r]=P(t[r]);return n}return t};var A=t=>u(void 0,null,function*(){return t>0?new Promise(n=>setTimeout(n,t)):null});var O=t=>t.split(";")[0].trim().toLowerCase(),U=t=>{let n=t.match(/\.([^./?]+)(?:[?#]|$)/);return n?n[1].toLowerCase():null},v=function(t,n,r){let m=n.get("Content-Type");if(m)return O(m);if(r&&r.Accept){let w=r.Accept.split(",");for(let d of w)if(d.trim()!=="*/*")return O(d)}let i=U(t);return i||""};var z={method:"get",retryCodes:[429,503,504],retryDelay:500},Q=t=>{t=y(y({},z),P(t));let n=0,r=0,m=0,i=null,w=e=>u(void 0,null,function*(){let s=Date.now(),l=e-(s-n);n=s+(l>0?l:0),yield A(l)}),d=e=>new Promise(s=>{i&&clearTimeout(i),i=setTimeout(s,e)}),b=e=>u(void 0,null,function*(){if(e.maxRequests!==void 0&&m>=e.maxRequests)return[new Error("Maximum request limit reached"),null,null];m++;let s={cache:e.cache,credentials:e.credentials,headers:e.headers,method:e.method,mode:e.mode,redirect:e.redirect,body:e.body?JSON.stringify(e.body):void 0},l=(e.domain||"")+(e.path||"");if(e.queryParams&&(l+="?"+new URLSearchParams(e.queryParams).toString()),e.timeout){let a=e.abort||new AbortController;s.signal=a.signal,setTimeout(()=>a.abort(),e.timeout)}let R=()=>u(void 0,null,function*(){var x;let a=yield((x=e.fetch)!=null?x:fetch)(l,s);if(!a.ok)return[new Error("Invalid response"),a,null];try{let o,p=!1,h=e.type||v(l,a.headers,e.headers);if(e.parsers){for(let c of e.parsers)if(p=c.types.includes(h),p){o=yield c.parser(a,e,h);break}}if(!p)switch(h.toLowerCase()){case"arraybuffer":o=yield a.arrayBuffer();break;case"blob":o=yield a.blob();break;case"formdata":o=yield a.formData();break;case"text/plain":case"text":case"txt":o=yield a.text();break;case"text/html-partial":case"html-partial":o=yield a.text();let c=document.createElement("template");c.innerHTML=o,o=c.content.childNodes;break;case"text/html":case"html":o=yield a.text(),o=new DOMParser().parseFromString(o,"text/html");break;case"application/json":case"text/json":case"json":o=yield a.json();break;case"image/svg+xml":case"svg":o=yield a.text(),o=new DOMParser().parseFromString(o,"image/svg+xml");break;case"application/xml":case"text/xml":case"xml":o=yield a.text(),o=new DOMParser().parseFromString(o,"application/xml");break}return[null,a,o]}catch(o){return[o||new Error("Thrown parsing error is falsy"),a,null]}}),f=()=>u(void 0,null,function*(){var p;let a=0,x=e.retryAttempts||0,o=e.retryDelay||0;for(;a<x;){let[h,c,C]=yield R();if(!h)return[h,c,C];if(!((p=e.retryCodes)!=null&&p.includes(c.status||200)))return[new Error("Invalid status code"),c,C];if(a++,a>=x)return[new Error("Too many retry attempts"),c,C];let g=o*Math.pow(2,a-1),E=c.headers.get("Retry-After");if(E){let D=parseInt(E,10);if(!isNaN(D))g=Math.max(g,D*1e3);else{let F=new Date(E).getTime();if(!isNaN(F)){let L=Date.now();g=Math.max(g,F-L)}}}yield A(g)}return R()}),[q,T,k]=yield f();return T.ok?[q,T,k]:[new Error(T.statusText),T,k]});return e=>u(void 0,null,function*(){let s=y(y({},t),P(e));t.headers&&(s.headers=y(y({},t.headers),s.headers)),s.debounce&&(yield d(s.debounce)),s.delay&&(yield A(s.delay)),s.throttle&&(yield w(s.throttle)),s.maxConcurrency&&r>=s.maxConcurrency&&(yield new Promise(R=>{let f=null,q=()=>{r>=s.maxConcurrency?f=requestAnimationFrame(q):(f&&clearInterval(f),R(null))};f=requestAnimationFrame(q)})),r++;let l=yield b(s);return r--,l})};export{Q as create};
//# sourceMappingURL=vroagn.base.min.js.map
