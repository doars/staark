var x=async a=>a>0?new Promise(o=>setTimeout(o,a)):null;var E=a=>a.split(";")[0].trim().toLowerCase(),F=a=>{let o=a.match(/\.([^./?]+)(?:[?#]|$)/);return o?o[1].toLowerCase():null},A=function(a,o,i){let d=o.get("Content-Type");if(d)return E(d);if(i&&i.Accept){let g=i.Accept.split(",");for(let p of g)if(p.trim()!=="*/*")return E(p)}let l=F(a);return l||""};var S={method:"get",retryCodes:[429,503,504],retryDelay:500},I=a=>{a={...S,...structuredClone(a)};let o=0,i=0,d=0,l=null,g=async e=>{let n=Date.now(),c=e-(n-o);o=n+(c>0?c:0),await x(c)},p=e=>new Promise(n=>{l&&clearTimeout(l),l=setTimeout(n,e)}),D=async e=>{if(e.maxRequests!==void 0&&d>=e.maxRequests)return[new Error("Maximum request limit reached"),null,null];d++;let n={cache:e.cache,credentials:e.credentials,headers:e.headers,method:e.method,mode:e.mode,redirect:e.redirect,body:e.body?JSON.stringify(e.body):void 0},c=(e.domain||"")+(e.path||"");if(e.queryParams&&(c+="?"+new URLSearchParams(e.queryParams).toString()),e.timeout){let r=e.abort||new AbortController;n.signal=r.signal,setTimeout(()=>r.abort(),e.timeout)}let h=async()=>{let r=await(e.fetch??fetch)(c,n);if(!r.ok)return[new Error("Invalid response"),r,null];try{let t,y=!1,m=e.type||A(c,r.headers,e.headers);if(e.parsers){for(let s of e.parsers)if(y=s.types.includes(m),y){t=await s.parser(r,e,m);break}}if(!y)switch(m.toLowerCase()){case"arraybuffer":t=await r.arrayBuffer();break;case"blob":t=await r.blob();break;case"formdata":t=await r.formData();break;case"text/plain":case"text":case"txt":t=await r.text();break;case"text/html-partial":case"html-partial":t=await r.text();let s=document.createElement("template");s.innerHTML=t,t=s.content.childNodes;break;case"text/html":case"html":t=await r.text(),t=new DOMParser().parseFromString(t,"text/html");break;case"application/json":case"text/json":case"json":t=await r.json();break;case"image/svg+xml":case"svg":t=await r.text(),t=new DOMParser().parseFromString(t,"image/svg+xml");break;case"application/xml":case"text/xml":case"xml":t=await r.text(),t=new DOMParser().parseFromString(t,"application/xml");break}return[null,r,t]}catch(t){return[t||new Error("Thrown parsing error is falsy"),r,null]}},u=async()=>{let r=0,t=e.retryAttempts||0,y=e.retryDelay||0;for(;r<t;){let[m,s,R]=await h();if(!m)return[m,s,R];if(!e.retryCodes?.includes(s.status||200))return[new Error("Invalid status code"),s,R];if(r++,r>=t)return[new Error("Too many retry attempts"),s,R];let f=y*Math.pow(2,r-1),q=s.headers.get("Retry-After");if(q){let P=parseInt(q,10);if(!isNaN(P))f=Math.max(f,P*1e3);else{let C=new Date(q).getTime();if(!isNaN(C)){let k=Date.now();f=Math.max(f,C-k)}}}await x(f)}return h()},[w,b,T]=await u();return b.ok?[w,b,T]:[new Error(b.statusText),b,T]};return async e=>{let n={...a,...structuredClone(e)};a.headers&&(n.headers={...a.headers,...n.headers}),n.debounce&&await p(n.debounce),n.delay&&await x(n.delay),n.throttle&&await g(n.throttle),n.maxConcurrency&&i>=n.maxConcurrency&&await new Promise(h=>{let u=null,w=()=>{i>=n.maxConcurrency?u=requestAnimationFrame(w):(u&&clearInterval(u),h(null))};u=requestAnimationFrame(w)}),i++;let c=await D(n);return i--,c}};export{I as create};
//# sourceMappingURL=vroagn.base.min.js.map
