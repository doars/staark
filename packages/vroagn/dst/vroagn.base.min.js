var D=(J)=>{if(typeof J==="object"){let M=Array.isArray(J)?[]:{};for(let N in J)M[N]=D(J[N]);return M}return J};var P=async(J)=>{if(J>0)return new Promise((M)=>setTimeout(M,J));return null};var S=(J)=>J.split(";")[0].trim().toLowerCase(),H=(J)=>{let M=J.match(/\.([^./?]+)(?:[?#]|$)/);return M?M[1].toLowerCase():null},V=(J,M,N)=>{let $=M.get("Content-Type");if($)return S($);if(N){if(N.Accept){let b=N.Accept.split(",");for(let _ of b)if(_.trim()!=="*/*")return S(_)}}let X=H(J);if(X)return X;return""};var h={method:"get",retryCodes:[429,503,504],retryDelay:500},T=(J)=>{J={...h,...D(J)};let M=0,N=0,$=0,X=null,b=async(B)=>{let K=Date.now(),W=B-(K-M);M=K+(W>0?W:0),await P(W)},_=(B)=>{return new Promise((K)=>{if(X)clearTimeout(X);X=setTimeout(K,B)})},w=async(B)=>{if(B.maxRequests!==void 0&&$>=B.maxRequests)return[Error("Maximum request limit reached"),null,null];$++;let K={cache:B.cache,credentials:B.credentials,headers:B.headers,method:B.method,mode:B.mode,redirect:B.redirect,body:B.body?JSON.stringify(B.body):void 0},W=(B.domain||"")+(B.path||"");if(B.queryParams)W+="?"+new URLSearchParams(B.queryParams).toString();if(B.timeout){let I=B.abort||new AbortController;K.signal=I.signal,setTimeout(()=>I.abort(),B.timeout)}let f=async()=>{let I=await(B.fetch??fetch)(W,K);if(!I.ok)return[Error("Invalid response"),I,null];try{let G,j=!1,Z=B.type||V(W,I.headers,B.headers);if(B.parsers){for(let Q of B.parsers)if(j=Q.types.includes(Z),j){G=await Q.parser(I,B,Z);break}}if(!j)switch(Z.toLowerCase()){case"arraybuffer":G=await I.arrayBuffer();break;case"blob":G=await I.blob();break;case"formdata":G=await I.formData();break;case"text/plain":case"text":case"txt":G=await I.text();break;case"text/html-partial":case"html-partial":G=await I.text();let Q=document.createElement("template");Q.innerHTML=G,G=Q.content.childNodes;break;case"text/html":case"html":G=await I.text(),G=new DOMParser().parseFromString(G,"text/html");break;case"application/json":case"text/json":case"json":G=await I.json();break;case"image/svg+xml":case"svg":G=await I.text(),G=new DOMParser().parseFromString(G,"image/svg+xml");break;case"application/xml":case"text/xml":case"xml":G=await I.text(),G=new DOMParser().parseFromString(G,"application/xml");break}return[null,I,G]}catch(G){return[G||Error("Thrown parsing error is falsy"),I,null]}},Y=async()=>{let I=0,G=B.retryAttempts||0,j=B.retryDelay||0;while(I<G){let[Z,Q,L]=await f();if(!Z)return[Z,Q,L];if(!B.retryCodes?.includes(Q.status||200))return[Error("Invalid status code"),Q,L];if(I++,I>=G)return[Error("Too many retry attempts"),Q,L];let k=j*Math.pow(2,I-1),U=Q.headers.get("Retry-After");if(U){let x=parseInt(U,10);if(!isNaN(x))k=Math.max(k,x*1000);else{let F=new Date(U).getTime();if(!isNaN(F)){let E=Date.now();k=Math.max(k,F-E)}}}await P(k)}return f()},[z,C,g]=await Y();if(!C.ok)return[Error(C.statusText),C,g];return[z,C,g]};return async(B)=>{let K={...J,...D(B)};if(J.headers)K.headers={...J.headers,...K.headers};if(K.debounce)await _(K.debounce);if(K.delay)await P(K.delay);if(K.throttle)await b(K.throttle);if(K.maxConcurrency&&N>=K.maxConcurrency)await new Promise((f)=>{let Y=null,z=()=>{if(N>=K.maxConcurrency)Y=requestAnimationFrame(z);else{if(Y)clearInterval(Y);f(null)}};Y=requestAnimationFrame(z)});N++;let W=await w(K);return N--,W}};export{T as create};

//# debugId=6335243648F4CB6A64756E2164756E21
