var j=Object.defineProperty;var M=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var F=(t,n,r)=>n in t?j(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,y=(t,n)=>{for(var r in n||(n={}))I.call(n,r)&&F(t,r,n[r]);if(M)for(var r of M(n))v.call(n,r)&&F(t,r,n[r]);return t};var u=(t,n,r)=>new Promise((m,c)=>{var h=e=>{try{w(r.next(e))}catch(s){c(s)}},d=e=>{try{w(r.throw(e))}catch(s){c(s)}},w=e=>e.done?m(e.value):Promise.resolve(e.value).then(h,d);w((r=r.apply(t,n)).next())});var R=t=>{if(typeof t=="object")if(Array.isArray(t)){let n=[];for(let r=0;r<t.length;r++)n.push(R(t[r]));t=n}else{let n={};for(let r in t)n[r]=R(t[r]);t=n}return t};var A=t=>u(void 0,null,function*(){return t>0?new Promise(n=>setTimeout(n,t)):null});var O=t=>t.split(";")[0].trim().toLowerCase(),U=t=>{let n=t.match(/\.([^./?]+)(?:[?#]|$)/);return n?n[1].toLowerCase():null},L=function(t,n,r){let m=n.get("Content-Type");if(m)return O(m);if(r&&r.Accept){let h=r.Accept.split(",");for(let d of h)if(d.trim()!=="*/*")return O(d)}let c=U(t);return c||""};var z={method:"get",retryCodes:[429,503,504],retryDelay:500},Q=t=>{t=y(y({},z),R(t));let n=0,r=0,m=0,c=null,h=e=>u(void 0,null,function*(){let s=Date.now(),i=e-(s-n);n=s+(i>0?i:0),yield A(i)}),d=e=>new Promise(s=>{c&&clearTimeout(c),c=setTimeout(s,e)}),w=e=>u(void 0,null,function*(){if(e.maxRequests!==void 0&&m>=e.maxRequests)return[new Error("Maximum request limit reached"),null,null];m++;let s={cache:e.cache,credentials:e.credentials,headers:e.headers,method:e.method,mode:e.mode,redirect:e.redirect,body:e.body?JSON.stringify(e.body):void 0},i=(e.domain||"")+(e.path||"");if(e.queryParams&&(i+="?"+new URLSearchParams(e.queryParams).toString()),e.timeout){let o=e.abort||new AbortController;s.signal=o.signal,setTimeout(()=>o.abort(),e.timeout)}let q=()=>u(void 0,null,function*(){let o=yield fetch(i,s);if(!o.ok)return[new Error("Invalid response"),o,null];try{let a,b=!1,p=e.type||L(i,o.headers,e.headers);if(e.parsers){for(let l of e.parsers)if(b=l.types.includes(p),b){a=yield l.parser(o,e,p);break}}if(!b)switch(p.toLowerCase()){case"arraybuffer":a=yield o.arrayBuffer();break;case"blob":a=yield o.blob();break;case"formdata":a=yield o.formData();break;case"text/plain":case"text":case"txt":a=yield o.text();break;case"text/html-partial":case"html-partial":a=yield o.text();let l=document.createElement("template");l.innerHTML=a,a=l.content.childNodes;break;case"text/html":case"html":a=yield o.text(),a=new DOMParser().parseFromString(a,"text/html");break;case"application/json":case"text/json":case"json":a=yield o.json();break;case"image/svg+xml":case"svg":a=yield o.text(),a=new DOMParser().parseFromString(a,"image/svg+xml");break;case"application/xml":case"text/xml":case"xml":a=yield o.text(),a=new DOMParser().parseFromString(a,"application/xml");break}return[null,o,a]}catch(a){return[a||new Error("Thrown parsing error is falsy"),o,null]}}),f=()=>u(void 0,null,function*(){var p;let o=0,a=e.retryAttempts||0,b=e.retryDelay||0;for(;o<a;){let[l,x,C]=yield q();if(!l)return[l,x,C];if(!((p=e.retryCodes)!=null&&p.includes(x.status||200)))return[new Error("Invalid status code"),x,C];if(o++,o>=a)return[new Error("Too many retry attempts"),x,C];let g=b*Math.pow(2,o-1),E=x.headers.get("Retry-After");if(E){let D=parseInt(E,10);if(!isNaN(D))g=Math.max(g,D*1e3);else{let S=new Date(E).getTime();if(!isNaN(S)){let N=Date.now();g=Math.max(g,S-N)}}}yield A(g)}return q()}),[T,P,k]=yield f();return P.ok?[T,P,k]:[new Error(P.statusText),P,k]});return e=>u(void 0,null,function*(){let s=y(y({},t),R(e));t.headers&&(s.headers=y(y({},t.headers),s.headers)),s.debounce&&(yield d(s.debounce)),s.delay&&(yield A(s.delay)),s.throttle&&(yield h(s.throttle)),s.maxConcurrency&&r>=s.maxConcurrency&&(yield new Promise(q=>{let f=null,T=()=>{r>=s.maxConcurrency?f=requestAnimationFrame(T):(f&&clearInterval(f),q(null))};f=requestAnimationFrame(T)})),r++;let i=yield w(s);return r--,i})};export{Q as create};
//# sourceMappingURL=vroagn.base.min.js.map
