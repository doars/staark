var j=Object.defineProperty;var M=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var F=(r,n,t)=>n in r?j(r,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[n]=t,y=(r,n)=>{for(var t in n||(n={}))I.call(n,t)&&F(r,t,n[t]);if(M)for(var t of M(n))v.call(n,t)&&F(r,t,n[t]);return r};var u=(r,n,t)=>new Promise((m,c)=>{var p=e=>{try{h(t.next(e))}catch(s){c(s)}},d=e=>{try{h(t.throw(e))}catch(s){c(s)}},h=e=>e.done?m(e.value):Promise.resolve(e.value).then(p,d);h((t=t.apply(r,n)).next())});var R=r=>{if(typeof r=="object")if(Array.isArray(r)){let n=[];for(let t=0;t<r.length;t++)n.push(R(r[t]));r=n}else{let n={};for(let t in r)n[t]=R(r[t]);r=n}return r};var A=r=>u(void 0,null,function*(){return r>0?new Promise(n=>setTimeout(n,r)):null});var O=r=>r.split(";")[0].trim().toLowerCase(),U=r=>{let n=r.match(/\.([^./?]+)(?:[?#]|$)/);return n?n[1].toLowerCase():null},L=function(r,n,t){let m=n.get("Content-Type");if(m)return O(m);if(t&&t.Accept){let p=t.Accept.split(",");for(let d of p)if(d.trim()!=="*/*")return O(d)}let c=U(r);return c||""};var z={method:"get",retryCodes:[429,503,504],retryDelay:500},Q=r=>{r=y(y({},z),R(r));let n=0,t=0,m=0,c=null,p=e=>u(void 0,null,function*(){let s=Date.now(),i=e-(s-n);n=s+(i>0?i:0),yield A(i)}),d=e=>new Promise(s=>{c&&clearTimeout(c),c=setTimeout(s,e)}),h=e=>u(void 0,null,function*(){if(e.maxRequests!==void 0&&m>=e.maxRequests)return[new Error("Maximum request limit reached"),null,null];m++;let s={cache:e.cache,credentials:e.credentials,headers:e.headers,method:e.method,mode:e.mode,redirect:e.redirect,body:e.body?JSON.stringify(e.body):void 0},i=(e.domain||"")+(e.path||"");if(e.queryParams&&(i+="?"+new URLSearchParams(e.queryParams).toString()),e.timeout){let o=e.abort||new AbortController;s.signal=o.signal,setTimeout(()=>o.abort(),e.timeout)}let P=()=>u(void 0,null,function*(){let o=yield fetch(i,s);if(!o.ok)return[new Error("Invalid response"),o,null];try{let a,w=!1,b=e.type||L(i,o.headers,e.headers);if(e.responseParsers){for(let l of e.responseParsers)if(w=l.types.includes(b),w){a=yield l.parser(o,e);break}}if(!w)switch(b.toLowerCase()){case"arraybuffer":a=yield o.arrayBuffer();break;case"blob":a=yield o.blob();break;case"formdata":a=yield o.formData();break;case"text/plain":case"text":case"txt":a=yield o.text();break;case"text/html-partial":case"html-partial":a=yield o.text();let l=document.createElement("template");l.innerHTML=a,a=l.content.childNodes[0];break;case"text/html":case"html":a=yield o.text(),a=new DOMParser().parseFromString(a,"text/html");break;case"application/json":case"text/json":case"json":a=yield o.json();break;case"image/svg+xml":case"svg":a=yield o.text(),a=new DOMParser().parseFromString(a,"image/svg+xml");break;case"application/xml":case"text/xml":case"xml":a=yield o.text(),a=new DOMParser().parseFromString(a,"application/xml");break}return[null,o,a]}catch(a){return[a||new Error("Thrown parsing error is falsy"),o,null]}}),f=()=>u(void 0,null,function*(){var b;let o=0,a=e.retryAttempts||0,w=e.retryDelay||0;for(;o<a;){let[l,x,C]=yield P();if(!l)return[l,x,C];if(!((b=e.retryCodes)!=null&&b.includes(x.status||200)))return[new Error("Invalid status code"),x,C];if(o++,o>=a)return[new Error("Too many retry attempts"),x,C];let g=w*Math.pow(2,o-1),E=x.headers.get("Retry-After");if(E){let D=parseInt(E,10);if(!isNaN(D))g=Math.max(g,D*1e3);else{let S=new Date(E).getTime();if(!isNaN(S)){let N=Date.now();g=Math.max(g,S-N)}}}yield A(g)}return P()}),[q,T,k]=yield f();return T.ok?[q,T,k]:[new Error(T.statusText),T,k]});return e=>u(void 0,null,function*(){let s=y(y({},r),R(e));r.headers&&(s.headers=y(y({},r.headers),s.headers)),s.debounce&&(yield d(s.debounce)),s.delay&&(yield A(s.delay)),s.throttle&&(yield p(s.throttle)),s.maxConcurrency&&t>=s.maxConcurrency&&(yield new Promise(P=>{let f=null,q=()=>{t>=s.maxConcurrency?f=requestAnimationFrame(q):(f&&clearInterval(f),P(null))};f=requestAnimationFrame(q)})),t++;let i=yield h(s);return t--,i})};export{Q as create};
//# sourceMappingURL=vroagn.base.min.js.map
