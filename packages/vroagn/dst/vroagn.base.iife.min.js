"use strict";(()=>{var C=function(n,i){let a=window;for(let o=0;o<n.length-1;o++)(typeof a[n[o]]!="object"||!Array.isArray(a[n[o]]))&&(a[n[o]]={}),a=a[n[o]];a[n[n.length-1]]=i};var b=async n=>n>0?new Promise(i=>setTimeout(i,n)):null;var E=n=>n.split(";")[0].trim().toLowerCase(),v=n=>{let i=n.match(/\.([^./?]+)(?:[?#]|$)/);return i?i[1].toLowerCase():null},D=function(n,i,a){let o=i.get("Content-Type");if(o)return E(o);if(a&&a.Accept){let x=a.Accept.split(",");for(let p of x)if(p.trim()!=="*/*")return E(p)}let u=v(n);return u||""};var M={method:"get",retryCodes:[429,503,504],retryDelay:500},k=n=>{n={...M,...structuredClone(n)};let i=0,a=0,o=0,u=null,x=async e=>{let s=Date.now(),l=e-(s-i);i=s+(l>0?l:0),await b(l)},p=e=>new Promise(s=>{u&&clearTimeout(u),u=setTimeout(s,e)}),F=async e=>{if(e.maxRequests!==void 0&&o>=e.maxRequests)return[new Error("Maximum request limit reached"),null,null];o++;let s={cache:e.cache,credentials:e.credentials,headers:e.headers,method:e.method,mode:e.mode,redirect:e.redirect,body:e.body?JSON.stringify(e.body):void 0},l=(e.domain||"")+(e.path||"");if(e.queryParams&&(l+="?"+new URLSearchParams(e.queryParams).toString()),e.timeout){let r=e.abort||new AbortController;s.signal=r.signal,setTimeout(()=>r.abort(),e.timeout)}let w=async()=>{let r=await(e.fetch??fetch)(l,s);if(!r.ok)return[new Error("Invalid response"),r,null];try{let t,y=!1,d=e.type||D(l,r.headers,e.headers);if(e.parsers){for(let c of e.parsers)if(y=c.types.includes(d),y){t=await c.parser(r,e,d);break}}if(!y)switch(d.toLowerCase()){case"arraybuffer":t=await r.arrayBuffer();break;case"blob":t=await r.blob();break;case"formdata":t=await r.formData();break;case"text/plain":case"text":case"txt":t=await r.text();break;case"text/html-partial":case"html-partial":t=await r.text();let c=document.createElement("template");c.innerHTML=t,t=c.content.childNodes;break;case"text/html":case"html":t=await r.text(),t=new DOMParser().parseFromString(t,"text/html");break;case"application/json":case"text/json":case"json":t=await r.json();break;case"image/svg+xml":case"svg":t=await r.text(),t=new DOMParser().parseFromString(t,"image/svg+xml");break;case"application/xml":case"text/xml":case"xml":t=await r.text(),t=new DOMParser().parseFromString(t,"application/xml");break}return[null,r,t]}catch(t){return[t||new Error("Thrown parsing error is falsy"),r,null]}},m=async()=>{let r=0,t=e.retryAttempts||0,y=e.retryDelay||0;for(;r<t;){let[d,c,R]=await w();if(!d)return[d,c,R];if(!e.retryCodes?.includes(c.status||200))return[new Error("Invalid status code"),c,R];if(r++,r>=t)return[new Error("Too many retry attempts"),c,R];let f=y*Math.pow(2,r-1),q=c.headers.get("Retry-After");if(q){let P=parseInt(q,10);if(!isNaN(P))f=Math.max(f,P*1e3);else{let A=new Date(q).getTime();if(!isNaN(A)){let S=Date.now();f=Math.max(f,A-S)}}}await b(f)}return w()},[h,g,T]=await m();return g.ok?[h,g,T]:[new Error(g.statusText),g,T]};return async e=>{let s={...n,...structuredClone(e)};n.headers&&(s.headers={...n.headers,...s.headers}),s.debounce&&await p(s.debounce),s.delay&&await b(s.delay),s.throttle&&await x(s.throttle),s.maxConcurrency&&a>=s.maxConcurrency&&await new Promise(w=>{let m=null,h=()=>{a>=s.maxConcurrency?m=requestAnimationFrame(h):(m&&clearInterval(m),w(null))};m=requestAnimationFrame(h)}),a++;let l=await F(s);return a--,l}};C(["vroagn"],{create:k});})();
//# sourceMappingURL=vroagn.base.iife.min.js.map
